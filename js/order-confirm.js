function Province(e){this.container=$(e),this.createDom(),this.getData(),this.bindEvents()}function City(e){this.container=$(e),this.createDom(),this.bindEvents()}function Area(e){this.container=$(e),this.createDom(),this.bindEvents()}var Order={};Order={data:{},payway:"1",index:"0",activeClass:"select-selected",title:"",titleType:"",Box:function(){layer.open({type:1,title:this.title,move:!1,skin:"layui-layer-rim",area:["500px","380px"],content:'<form method="post" action="" id="loginform"><div id="login"><div class="div1"><span class="location">所在地区：</span><section class="js-area"></section><ul id="street"><li>其他</li></ul><ul class="street-ul"></ul></div><div><span>详细地址：</span><input type="text" id="addAddress" /></div><div><span>收货人：</span><input type="text" id="addReceiver" /></div><div><span>手机号：</span><input type="text" id="addReceiveTel" /></div><p class="default-add"><input type="checkbox" />是否设置默认地址</p><div><button type="button" class="buttongro">保存并使用</button></div></div></form>'})},GetQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?encodeURI(i[2]):""},regtest:function(e){},init:function(){step.goStep(2),this.getData(),this.bindEvents()},getData:function(){Handlebars.registerHelper("transformOrderType",function(e){return 1==e?"京 东":2==e?"苏 宁":void 0}),$.ajax({type:"GET",cache:!1,url:"../js/json/order-confirm.json",success:$.proxy(this.getDataSuccess,this)})},getDataSuccess:function(e){this.data=e,this.shippingAddressTemplateRender(),this.invoiceHeadingRender(this.data),this.goodsListRender(this.data),this.amountPayable(this.data),this.shippingInfo(this.data)},shippingAddressTemplateRender:function(){var e=$("#shippingaddressOne").html(),t=Handlebars.compile(e),i=t(this.data.ebOmReceiveList[0]);$(".addr-cuurent").html(i),$(".mor-addS").css("display","none"),$(".mor-add").css("display","block"),$(".addr-delete").on("click",$.proxy(this.deleteAddLi,this)),$(".addr-revise").on("click",$.proxy(this.receiveUpdate,this))},shippingAddressTemplateRenderM:function(){if(this.data.ebOmReceiveList.length<=1)return void layer.msg("暂无更多地址");var e=$("#shippingaddress").html(),t=Handlebars.compile(e),i=t(this.data.ebOmReceiveList);$(".addr-cuurent").html(i),$(".mor-addS").css("display","block"),$(".mor-add").css("display","none"),$(".addr-ico").attr("style","background-position: -11px 1px");var a=$(".more-li").eq(0);a.attr("style","border:1px solid #008bf7;background:#e7f3fe;cursor: pointer;"),$(".more-li").hover(function(e){$(e.currentTarget).attr("style","border:1px solid #fff;background:#e7f3fe;cursor: pointer;"),a.attr("style","border:1px solid #008bf7;background:#e7f3fe;cursor: pointer;")},function(e){$(this).attr("style","border:1px solid #fff;background:#fff;"),a.attr("style","border:1px solid #008bf7;background:#e7f3fe;cursor: pointer;")}),$(".more-li").on("click",$.proxy(this.changeLiStyle,this)),$(".addr-delete").on("click",$.proxy(this.deleteAddLi,this)),$(".addr-revise").on("click",$.proxy(this.receiveUpdate,this))},invoiceHeadingRender:function(e){null!=e.ebOmInvoice&&$(".input").attr("placeholder",e.ebOmInvoice.invoiceHeading)},goodsListRender:function(e){var t=$("#goods-list-template").html(),i=Handlebars.compile(t),a=i(e.goods);$(".w1160").html(a)},amountPayable:function(e){var t=0;for(i=0;i<e.goods.length;i++)t+=parseInt(100*e.goods[i].subtotal);$(".pay-text").html("￥"+t/100)},shippingInfo:function(e){var t=$("#goods-info-template").html(),i=Handlebars.compile(t),a=i(e.ebOmReceiveList[0]);$(".goods-info").html(a)},changeLiStyle:function(e){$(".more-li").attr("style","border:0px solid #ccc");var t=$(e.target).parent().index(),i=this.data.ebOmReceiveList[t].oneStatus,a=this.data.ebOmReceiveList[t].twoStatus,s=this.data.ebOmReceiveList[t].threeStatus,r={oneStatus:i,twoStatus:a,threeStatus:s,receiveAddress:$(e.target).parent().find(".receiveAddress").html(),receiver:$(e.target).parent().find(".span1").html(),receiveTel:$(e.target).parent().find(".span3").html(),isDefault:"1",id:this.data.ebOmReceiveList[t].id};this.ajaxChooseUpdate(r)},ajaxChooseUpdate:function(e){$.ajax({type:"POST",cache:!1,url:baseUrl+"receive/update",contentType:"application/json",data:JSON.stringify(e),success:$.proxy(this.getData,this)})},deleteAddLi:function(e){e.stopPropagation(e);var t=$(e.target).parent().index(),i=this.data.ebOmReceiveList[t].id;$(e.target).parent().remove(),this.receiveDelete(i)},receiveDelete:function(e){var t=[e];$.ajax({type:"POST",cache:!1,url:baseUrl+"receive/delete",contentType:"application/json",data:JSON.stringify(t),success:$.proxy(this.getData,this)})},addCode:{provinceRegionCode:"",cityRegionCode:"",areaRegionCode:""},index:"",receiveUpdate:function(e){e.stopPropagation(e),this.title="修改收货地址",this.titleType="revise",this.Box();var t={receiveAddress:$(e.target).parent().find(".receiveAddress").text(),receiver:$(e.target).parent().find(".span1").text(),receiveTel:$(e.target).parent().find(".span3").text()},i=$(e.target).parent().index();this.index=i;var a=this.data.ebOmReceiveList[i].oneStatus,s=this.data.ebOmReceiveList[i].twoStatus,r=this.data.ebOmReceiveList[i].threeStatus,n=this.data.ebOmReceiveList[i].oneName,o=this.data.ebOmReceiveList[i].twoName,d=this.data.ebOmReceiveList[i].threeName;this.addCode.provinceRegionCode=a,this.addCode.cityRegionCode=s,this.addCode.areaRegionCode=r,this.province=new Province(".js-area"),this.city=new City(".js-area"),this.area=new Area(".js-area"),$(this.province).on("change",$.proxy(this.handleProvinceChange),this),$(this.city).on("change",$.proxy(this.handleCityChange),this),this.province.setTitle(n),this.handleProvinceChange({regionCode:a}),this.city.setTitle(o),this.handleCityChange({regionCode:s}),this.area.setTitle(d),$("#addAddress").val(t.receiveAddress),$("#addReceiver").val(t.receiver),$("#addReceiveTel").val(t.receiveTel)},receiveSave:function(){this.data.ebOmReceiveList.length>=10?alert("最多只能新增十条地址！！！"):(this.title="新增收货地址",this.titleType="add",this.Box()),this.province=new Province(".js-area"),this.city=new City(".js-area"),this.area=new Area(".js-area"),$(this.province).on("change",$.proxy(this.handleProvinceChange),this),$(this.city).on("change",$.proxy(this.handleCityChange),this)},handleProvinceChange:function(e){this.city.changeCity(e),this.city.reset(),this.area.reset()},handleCityChange:function(e){this.area.ChangeArea(e),this.area.reset()},handleButtonClick:function(){if("add"==this.titleType){var e={oneStatus:"",twoStatus:"",threeStatus:"",receiveAddress:"",receiver:"",receiveTel:"",isDefault:""};if(e.oneStatus=this.addCode.provinceRegionCode,e.twoStatus=this.addCode.cityRegionCode,e.threeStatus=this.addCode.areaRegionCode,e.receiveAddress=$("#addAddress").val(),e.receiver=$("#addReceiver").val(),e.receiveTel=$("#addReceiveTel").val(),"请选择省份"==$("#province li").text())return void layer.msg("请选择省份");if("请选择城市"==$("#city li").text())return void layer.msg("请选择城市");if("请选择地区"==$("#area li").text())return void layer.msg("请选择地区");if($("input[type='checkbox']").is(":checked")?e.isDefault=1:e.isDefault=0,!e.receiveAddress)return void layer.msg("请输入详细地址");if(!e.receiver)return void layer.msg("请输入收货人");if(!e.receiveTel)return void layer.msg("请输入收货人手机号");if(!/^1[3|4|5|8]\d{9}$/.test(e.receiveTel))return void layer.msg("手机号格式错误");this.ajaxSave(e),layer.closeAll()}else{var e={oneStatus:"",twoStatus:"",threeStatus:"",id:"",receiveAddress:"",receiver:"",receiveTel:"",isDefault:""};if(e.oneStatus=this.addCode.provinceRegionCode,e.twoStatus=this.addCode.cityRegionCode,e.threeStatus=this.addCode.areaRegionCode,e.id=this.data.ebOmReceiveList[this.index].id,e.receiveAddress=$("#addAddress").val(),e.receiver=$("#addReceiver").val(),e.receiveTel=$("#addReceiveTel").val(),"请选择省份"==$("#province li").text())return void layer.msg("请选择省份");if("请选择城市"==$("#city li").text())return void layer.msg("请选择城市");if("请选择地区"==$("#area li").text())return void layer.msg("请选择地区");if($("input[type='checkbox']").is(":checked")?e.isDefault=1:e.isDefault=0,!e.receiveAddress)return void layer.msg("请输入详细地址");if(!e.receiver)return void layer.msg("请输入收货人");if(!e.receiveTel)return void layer.msg("请输入收货人手机号");if(!/^1[3|4|5|8]\d{9}$/.test(e.receiveTel))return void layer.msg("手机号格式错误");this.ajaxUpdate(e),layer.closeAll()}},ajaxSave:function(e){$.ajax({type:"POST",contentType:"application/json",url:baseUrl+"receive/save",data:JSON.stringify(e),success:$.proxy(this.getData,this)})},ajaxUpdate:function(e){$.ajax({type:"POST",contentType:"application/json",url:baseUrl+"receive/update",data:JSON.stringify(e),success:$.proxy(this.getData,this)})},returnPayWay:function(e){var t=$(e.target);this.payway=t.index()+1,t.hasClass(this.activeClass)||($(".button-group").removeClass(this.activeClass),t.addClass(this.activeClass))},orderSuccess:function(){$(".order-btn").attr({disabled:"disabled",style:"background:#ccc"});for(var e=this.data.goods.length,t={},i=[],a=0;a<e;a++)t={cartId:this.data.goods[a].id,cartNum:this.data.goods[a].cartNum},i[i.length]=t;var s={oneStatus:this.data.ebOmReceiveList[0].oneStatus,twoStatus:this.data.ebOmReceiveList[0].twoStatus,threeStatus:this.data.ebOmReceiveList[0].threeStatus,receiveAddress:this.data.ebOmReceiveList[0].receiveAddress,receiver:this.data.ebOmReceiveList[0].receiver,receiveTel:this.data.ebOmReceiveList[0].receiveTel,invoiceHeading:this.data.ebOmInvoice?this.data.ebOmInvoice.invoiceHeading:"",payWay:this.payway||1,dataList:i};this.ajaxSubmitOrders(s)},ajaxSubmitOrders:function(e){$.ajax({url:"../js/json/submit-order.json",contentType:"application/json",success:$.proxy(this.orderComplateRender,this)})},orderComplateRender:function(e){if(successData=e.data.success,failedData=e.data.failed,0==e.code){var t=Handlebars.compile($("#t-order-failed").html());$(".main").html(t(failedData))}else if(1==e.code)if(failedData){var t=Handlebars.compile($("#t-order-success-failed").html());$(".main").html(t(e.data))}else{var t=Handlebars.compile($("#t-order-success").html());$(".main").html(t(successData))}else layer.msg("服务器错误,请刷新页面");step.goStep(3)},bindEvents:function(){$(".mor-add").on("click",$.proxy(this.shippingAddressTemplateRenderM,this)),$(".mor-addS").on("click",$.proxy(this.shippingAddressTemplateRender,this)),$(".mod").on("click",$.proxy(this.receiveSave,this)),$(".button-group").on("click",$.proxy(this.returnPayWay,this)),$(".order-btn").on("click",$.proxy(this.orderSuccess,this)),$("body").on("click",".buttongro",$.proxy(this.handleButtonClick,this))}},Province.prototype={data:{},show:!1,createDom:function(){this.elem=$('<ul id="province"><li>请选择省份</li></ul><ul class="province-ul"></ul>'),this.container.append(this.elem)},getData:function(){var e=this;$.ajax({dataType:"json",url:"../js/json/province.json",success:function(t){e.data=t}})},bindEvents:function(){var e=this;$("#province li").on("click",$.proxy(this.getProvData,this)),$(".province-ul").on("click","li",function(){e.handleProvinceClick($(this))})},getProvData:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.provinceTemplateRender(),$(".city-ul").find("li")&&$(".city-ul").attr("style","display:none;"),$(".area-ul").find("li")&&$(".area-ul").attr("style","display:none;")},provinceTemplateRender:function(){this.elem.find(".province-ul").css("display","block");var e=$("#province-template").html(),t=Handlebars.compile(e),i=t(this.data.ebOmDeliveraddress);$(".province-ul").html(i),$(".province-ul").attr("style","border:1px solid #ccc;"),$(".province-ul li").hover(function(){$(this).attr("style","background:#168ff3;color:#fff")},function(){$(this).attr("style","background:#fff;")})},handleProvinceClick:function(e){$("#province li").text(e.text()),$(".province-ul").attr("style","display:none;");var t=e.attr("value");Order.addCode.provinceRegionCode=t;var i={regionCode:t};Order.handleProvinceChange(i)},setTitle:function(e){$("#province li").text(e)}},City.prototype={elem:"",data:{},show:!1,createDom:function(){this.elem=$('<ul id="city"><li>请选择城市</li></ul><ul class="city-ul"></ul>'),this.container.append(this.elem)},changeCity:function(e){this.getData(e)},getData:function(e){var t=this;$.ajax({dataType:"json",url:"../js/json/city.json",success:function(e){t.data=e}})},bindEvents:function(){var e=this;$("#city li").on("click",$.proxy(this.getCityData,this)),$(".city-ul").on("click","li",function(){e.handleCitySelect($(this))})},setTitle:function(e){$("#city li").text(e)},handleCitySelect:function(e){$("#city li").text(e.text()),$(".city-ul").attr("style","display:none;");var t=e.attr("value");Order.addCode.cityRegionCode=t;var i={regionCode:t};Order.handleCityChange(i)},getCityData:function(e){if("请选择省份"==$("#province").text())return void layer.msg("请选择省份");e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.cityTemplateRender(),$(".province-ul").find("li")&&$(".province-ul").attr("style","display:none;"),$(".area-ul").find("li")&&$(".area-ul").attr("style","display:none;")},cityTemplateRender:function(){this.elem.find(".city-ul").css("display","block");var e=$("#city-template").html(),t=Handlebars.compile(e),i=t(this.data.ebOmDeliveraddress);$(".city-ul").html(i),$(".city-ul").attr("style","border:1px solid #ccc;"),$(".city-ul li").hover(function(){$(this).attr("style","background:#168ff3;color:#fff")},function(){$(this).attr("style","background:#fff;")})},reset:function(){$("#city").find("li").html("请选择城市")}},Area.prototype={elem:"",data:{},createDom:function(){this.elem=$('<ul id="area"><li>请选择地区</li></ul><ul class="area-ul"></ul>'),this.container.append(this.elem)},ChangeArea:function(e){this.getData(e)},getData:function(e){var t=this;$.ajax({dataType:"json",url:"../js/json/area.json",success:function(e){t.data=e}})},bindEvents:function(){var e=this;$("#area li").on("click",$.proxy(this.getAreaData,this)),$(".area-ul").on("click","li",function(){e.handleAreaChange($(this))})},getAreaData:function(e){if("请选择城市"==$("#city").text())return void layer.msg("请选择城市");e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.areaTemplateRender(),$(".province-ul").find("li")&&$(".province-ul").attr("style","display:none;"),$(".city-ul").find("li")&&$(".city-ul").attr("style","display:none;")},areaTemplateRender:function(){$(".area-ul").attr("style","display:block;");var e=$("#city-template").html(),t=Handlebars.compile(e),i=t(this.data.ebOmDeliveraddress);$(".area-ul").html(i),$(".area-ul").attr("style","border:1px solid #ccc;"),$(".area-ul li").hover(function(){$(this).attr("style","background:#168ff3;color:#fff")},function(){$(this).attr("style","background:#fff;")})},handleAreaChange:function(e){$("#area li").text(e.text()),$(".area-ul").attr("style","display:none;");var t=e.attr("value");Order.addCode.areaRegionCode=t},setTitle:function(e){$("#area li").text(e)},reset:function(){$("#area").find("li").html("请选择地区")}},$(document).ready(function(){Order.init()}),$(document).on("click",function(){$(".province-ul").hide(),$(".city-ul").hide(),$(".area-ul").hide()});