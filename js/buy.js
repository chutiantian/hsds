function getdata(t,e,n,c,a){n=n||"GET";var i;i=a?"application/json":"application/x-www-form-urlencoded";var o;$.ajax({type:n,contentType:i,url:t,dataType:"json",timeout:1e4,data:e,async:!0,beforeSend:function(){o=layer.load(1,{shade:[.5,"#000"]})},complete:function(t,e){layer.close(o),"timeout"==e&&layer.msg("请求超时")},success:function(t){null!=c&&"function"==typeof c&&c(t)},error:function(){console.log("请求超时")}})}var opt={id:""};$(function(){function t(t){this.tpl="",this.tplId="t-buy",this.data=t,this.selectIds=[],this.selectMap={},0!=this.data.code&&0!=this.data.data.length||($(".detail-h365").hide(),$(".item-empty").show(),$(".buy-btn").click(function(){location.href="./program.html"}))}step.goStep(1);var e="../js/json/buy.json";getdata(e,{},"get",function(e){var n=new t(e);n.init(),n.show()}),t.prototype={init:function(){this.tpl=Handlebars.compile($("#"+this.tplId).html()),this.regHelper()},regHelper:function(){Handlebars.registerHelper("eq",function(t,e,n){return t==e?n.fn(this):n.inverse(this)})},show:function(){var t=this.data.data;$(".buy-list").html(this.tpl(t)),this.buildEvent(),this.checkAll()},buildEvent:function(){var t=this;$(".buy-checkall").bind("click",function(e){e.currentTarget.checked?t.checkAll():t.checkClear()}),$(".buy-cut").bind("click",function(e){t.reduceHander(e)}),$(".buy-add").bind("click",function(e){t.plusHander(e)}),$(".buy-check").bind("click",function(e){t.checkHander(e)}),$(".delete").bind("click",function(t){var n=$(this).attr("did");opt.id=n,layer.confirm("确定删除此商品吗？",{btn:["确定","取消"]},function(){function t(t){1==t.code?(layer.msg("删除成功",{time:1e3}),setTimeout(function(){window.location.reload()},1e3)):layer.msg("删除失败",{time:1e3})}var c=[];c.push(n);var a=JSON.stringify(c);getdata(e,a,"POST",t,"1")},function(){layer.msg("已取消",{time:1e3})})}),$("#deleteAll").bind("click",function(t){if(0!=selectedTotal.innerHTML){var n=[];$("input.buy-check:checked").each(function(t){n.push($(this).val())}),layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){function t(t){1==t.code?(layer.msg("删除成功",{time:1e3}),setTimeout(function(){window.location.reload()},1e3)):layer.msg("删除失败",{time:1e3})}var c=JSON.stringify(n);getdata(e,c,"POST",t,"1")},function(){layer.msg("已取消",{time:1e3})})}else layer.msg("请选择商品！",{time:1e3})}),$(".order-btn").bind("click",function(){var t=[];$("input.buy-check:checked").each(function(e){t.push($(this).val())}),console.log(t);var e="ids="+t.join("-");location.href="./order-confirm.html?"+e})},checkAll:function(){$("input:checkbox").each(function(){$(this)[0].checked=!0}),this.selectAll(),this.showToltInfo()},checkClear:function(){$("input:checkbox").each(function(){$(this)[0].checked=!1}),this.unSelectAll(),this.showToltInfo()},delItem:function(t){$(t).parents(".sc").remove();this.updateCount()},delAllItem:function(){$(".sc").find(".buy-check:checked").parents(".sc").remove(),this.updateCount()},selectedItem:function(t){var e=this;$.each(this.data.data,function(n,c){this.id==t&&(e.data.data[n].selected=1)})},unSelectedItem:function(t){var e=this;$.each(this.data.data,function(n,c){this.id==t&&(e.data.data[n].selected=0)})},selectAll:function(){var t=this;$.each(this.data.data,function(e,n){t.data.data[e].selected=1})},unSelectAll:function(){var t=this;$.each(this.data.data,function(e,n){t.data.data[e].selected=0})},addCountById:function(t){},plusById:function(t){var e=this;$.each(this.data.data,function(n,c){c.id==t&&(e.data.data[n].cartNum=c.cartNum+1,e.data.data[n].subtotal=c.cartNum*c.cartPrice)})},reduceById:function(t){var e=this;$.each(this.data.data,function(n,c){c.id==t&&(e.data.data[n].cartNum=c.cartNum-1,e.data.data[n].subtotal=c.cartNum*c.cartPrice)})},delCountById:function(t){$.each(this.data.data,function(e,n){this.id==t&&this.data.splice(e,1)})},getInfoById:function(t){var e={};return $.each(this.data.data,function(n,c){if(this.id==t)return e=this,!1}),e},getToltInfo:function(){var t={count:0,countPrice:0};return $.map(this.data.data,function(e,n){e.selected&&(t.count=t.count+1,t.countPrice=t.countPrice+1*e.subtotal)}),t},showToltInfo:function(){this.updateCount()},reduceHander:function(t){var e=$(t.currentTarget),n=e.next("input"),c={},a=1*n.val(),i=e.parent().parent().parent().find("input:checkbox").val();a<2||(c=this.getInfoById(i),this.reduceById(i),this.updateCount(),n.val(a-1),e.parent().parent().next().find(".buy-coutp").text((a-1)*c.cartPrice))},plusHander:function(t){var e=$(t.currentTarget),n=e.prev("input"),c=1*n.val(),a=e.parent().parent().parent().find("input:checkbox").val(),i=this.getInfoById(a);this.plusById(a),this.updateCount(),n.val(c+1),e.parent().parent().next().find(".buy-coutp").text((c+1)*i.cartPrice)},updateCount:function(){var t=this.getToltInfo();$(".countNum").text(t.count),$(".countPrice").text(t.countPrice)},checkHander:function(t){var e=t.currentTarget;e.checked?this.selectedItem(e.value):this.unSelectedItem(e.value),this.itemCheckAll(),this.updateCount()},itemCheckAll:function(t){var e=$(".order-item .item-check").children("input").length,n=$(".order-item .item-check").children("input:checked").length;console.log(e),console.log(n),e===n?$("input.buy-checkall").prop("checked",!0):$("input.buy-checkall").prop("checked",!1)}}});